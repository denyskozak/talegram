generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProposalStatus {
  PENDING
  APPROVED
  REJECTED
}

model BookProposal {
  id            String          @id @default(uuid())
  title         String
  author        String
  description   String
  tonStorageKey String          @map("ton_storage_key")
  tonStorageUrl String          @map("ton_storage_url")
  coverTonStorageKey String?   @map("cover_ton_storage_key")
  coverTonStorageUrl String?   @map("cover_ton_storage_url")
  coverMimeType      String?   @map("cover_mime_type")
  coverFileName      String?   @map("cover_file_name")
  coverFileSize      Int?      @map("cover_file_size")
  mimeType      String?         @map("mime_type")
  fileName      String          @map("file_name")
  fileSize      Int?            @map("file_size")
  status        ProposalStatus  @default(PENDING)
  reviewerNotes String?         @map("reviewer_notes")
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  books         Book[]
  votes         ProposalVote[]

  @@map("book_proposals")
}

model Book {
  id            String         @id @default(uuid())
  title         String
  author        String
  description   String
  tonStorageKey String         @map("ton_storage_key")
  tonStorageUrl String         @map("ton_storage_url")
  coverTonStorageKey String?  @map("cover_ton_storage_key")
  coverTonStorageUrl String?  @map("cover_ton_storage_url")
  coverMimeType      String?  @map("cover_mime_type")
  coverFileName      String?  @map("cover_file_name")
  coverFileSize      Int?     @map("cover_file_size")
  mimeType      String?        @map("mime_type")
  fileName      String         @map("file_name")
  fileSize      Int?           @map("file_size")
  proposalId    String?        @map("proposal_id")
  proposal      BookProposal?  @relation(fields: [proposalId], references: [id])
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  @@map("books")
}

model ProposalVote {
  id             String        @id @default(uuid())
  proposalId     String        @map("proposal_id")
  proposal       BookProposal  @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  telegramUserId String        @map("telegram_user_id")
  isPositive     Boolean       @map("is_positive")
  createdAt      DateTime      @default(now()) @map("created_at")

  @@unique([proposalId, telegramUserId])
  @@map("proposal_votes")
}
